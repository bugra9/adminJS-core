/**
 * AdminJS v0.1
 *
 * @link   https://github.com/bugra9/adminJS
 * @author bugra9 https://github.com/bugra9
 * @license MIT
 */
"use strict";function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_createClass=function(){function t(t,i){for(var e=0;e<i.length;e++){var a=i[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(i,e,a){return e&&t(i.prototype,e),a&&t(i,a),i}}(),AdminJS=function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t),this.settings={debug:0};for(var e in i)this.settings[e]=i[e];this.log("Ayarlar Yüklendi.",2),this.log("Yazılım Başlatılıyor...",2);var a=window.location.href.split("#");a.length>1&&(a=a[1].split("/")),"connect"==a[0]&&(localStorage.token=a[1],window.location.href="#list/_posts/")}return _createClass(t,[{key:"run",value:function(){this.log("Veriler Yükleniyor",2),this.loadData(),this.loadMenu(),this.loadOption(),this.log("Menü Yükleniyor",2),this.createMenu(),this.log("Tetiklemeler yükleniyor",2),this.event(),this.log("Yazılım başarıyla başlatıldı.",1)}},{key:"createMenu",value:function(){this.log("Menü Oluşturuluyor",2),this.log("====== Menü Nesnesi =====",2),this.log(this.menu,2);var t="";for(var i in this.menu)t+=this.menu[i].html?this.menu[i].html:'\n\t\t\t\t\t<a class="item" href="#'+this.menu[i].path+'">\n\t\t\t\t\t\t'+this.menu[i].title+' \n\t\t\t\t\t\t<div class="ui left pointing label '+this.menu[i].color+'">'+this.menu[i].count+"</div>\n\t\t\t\t\t</a>";this.write(t,"#menu"),this.log("Menü oluşturuldu",2)}},{key:"loadData",value:function(){this.log("Veriler yükleniyor",2),this.data=[]}},{key:"loadMenu",value:function(){this.menu=[]}},{key:"loadOption",value:function(){this.options={}}},{key:"event",value:function(){var t=this;window.addEventListener("hashchange",function(){t.navigation()},!1),this.navigation()}},{key:"findAll",value:function(t){var i=[];for(var e in this.data){var a=!0;for(var n in t){var s=this.getDataAttr(t[n].attr,e);if(!this.condition(t[n].op,s,t[n].value)){a=!1;break}}a&&i.push(e)}return i}},{key:"condition",value:function(t,i,e){switch(t){case"==":return i==e;case">=":return i>=e;case">":return i>e;case"<=":return i<=e;case"<":return i<e;case"[]":return e.indexOf(i)!=-1;case"contain":return i.indexOf(e)!=-1;case"path":return i.indexOf(e)!=-1&&i.split("/").length==e.split("/").length}return!1}},{key:"getDataAttr",value:function(t,i){if(void 0!==i){var e,a=t.split(".");e=i==-1?this.tempData:this.data[i],1==a.length&&(e=e.content);for(var n in a)e=e[a[n]];return e}}},{key:"templateInput",value:function(t,i,e){var a={list:"",edit:""},n="";switch(t.input.type){case"text":void 0===i&&(i=""),a.list="<td>"+i+"</td>";var s="";t.input.wysiwyg&&(s="mdEditor"),t.input.rows&&t.input.rows>1||t.input.wysiwyg?a.edit='\n<div class="field">\n\t<label>'+t.title+'</label>\n\t<textarea class="'+s+'" rows="'+t.input.rows+'" name="'+t.attr+'">'+i+"</textarea>\n</div>":a.edit='\n<div class="field">\n\t<label>'+t.title+'</label>\n\t<input type="text" name="'+t.attr+'" value="'+i+'" />\n</div>';break;case"date":var l=new Date(i),o=["Ocak","Şubat","Mart","Nisan","Mayıs","Haziran","Temmuz","Ağustos","Eylül","Ekim","Kasım","Aralık"];a.list='<td title="'+i+'">'+l.getDate()+" "+o[l.getMonth()]+" "+l.getFullYear()+"</td>",a.edit='\n<div class="field">\n\t<label>'+t.title+'</label>\n\t<div class="ui calendar">\n\t\t<div class="ui input left icon">\n\t\t\t<i class="calendar icon"></i>\n\t\t\t<input type="datetime" placeholder="Zaman" name="'+t.attr+'" value="'+i+'">\n\t\t</div>\n\t</div>\n</div>';break;case"select":if(t.input.isRelated&&""!==i){var r=t.input.options.slice(0),h="==";Array.isArray(i)&&(h="[]"),r.push({attr:t.input.value,value:i,op:h});var d=this.findAll(r);if(0===d.length)n="";else if(1==d.length)n=this.data[d[0]].content.title;else{n="";for(var u in d)n+='<div class="ui label">'+this.data[d[u]].content.title+"</div>"}}else n=i;if(a.list="<td>"+n+"</td>",n=t.input.multiple?"multiple":"",a.edit='\n<div class="field">\n\t<div class="leftRight">\n\t\t<label>'+t.title+'</label>\n\t\t<div><i class="add icon green link"></i></div>\n\t</div>\n\t<select class="ui selection dropdown search" name="'+t.attr+'" '+n+'><option value="">Seç</option>',t.input.isRelated){var c=this.findAll(t.input.options);for(var v in c)Array.isArray(i)||(i=[i]),n=void 0!==i&&i.indexOf(this.data[c[v]].content[t.input.value])!=-1?"selected":"",a.edit+='<option value="'+this.data[c[v]].content[t.input.value]+'" '+n+">"+this.data[c[v]].content.title+"</option>"}else for(var f in t.input.options)n=f==i?"selected":"",a.edit+='<option value="'+f+'" '+n+">"+t.input.options[f]+"</option>";a.edit+="\n\t</select>\n</div>"}return a[e]}},{key:"inputInit",value:function(t){$(".ui.dropdown.search.addition").dropdown({allowAdditions:!0}),$(".ui.dropdown:not(.addition)").dropdown(),$(".ui.calendar").calendar({monthFirst:!1,ampm:!1,today:!0,text:{days:["P","P","S","Ç","P","C","C"],months:["Ocak","Şubat","Mart","Nisan","Mayıs","Haziran","Temmuz","Ağustos","Eylül","Ekim","Kasım","Aralık"],monthsShort:["Oca","Şub","Mar","Nis","May","Haz","Tem","Ağu","Eyl","Eki","Kas","Ara"],today:"Bugün",now:"Şu an",am:"ÖÖ",pm:"ÖS"}})}},{key:"defaultType",value:function(t,i){return Array.isArray(i)?{attr:t,title:t,list:{show:!0},input:{type:"select",isRelated:!1,multiple:!0,options:[]}}:"object"!==("undefined"==typeof i?"undefined":_typeof(i))?{attr:t,title:t,list:{show:!0},input:{type:"text"}}:void 0}},{key:"getType",value:function(t){var i={};for(var e in this.options)if(t.indexOf(e)!=-1)for(var a in this.options[e])i[this.options[e][a].attr]=this.options[e][a];return i}},{key:"getAttrList",value:function(t,i){var e=[],a={};for(var n in t){var s=this.data[t[n]];for(var l in s.content)void 0===a[l]?a[l]=1:++a[l]}a["file.path"]=t.length;var o=[];for(n in a)o.push([n,a[n]]);o.sort(function(t,i){return t[1]-i[1]});for(n in o)o[n][1]=o[n][1]/t.length*100,o[n][1]>50&&(!i[o[n][0]]||0!=i[o[n][0]].list.show)&&e.length<10&&e.push(o[n][0]);return e}},{key:"write",value:function(t,i){var e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e?$(i).html(t):$(i).append(t)}},{key:"log",value:function(t,i){this.settings.debug>=i&&console.log(t)}},{key:"getDirs",value:function(t){var i={},e=t.split("/").length;for(var a in this.data){var n=this.data[a].file.path.split("/").length;0===this.data[a].file.path.indexOf(t)&&n==e+1&&(i[this.data[a].file.path.substring(t.length,this.data[a].file.path.lastIndexOf("/"))]=0)}var s=[];for(a in i)s.push(a);return s}},{key:"navigationDelete",value:function(t){var i=this.findAll([{attr:"file.path",value:t,op:"=="}])[0];this.data.splice(i,1),this.deleteData(t),window.location.href="#list/"+t.substring(0,t.lastIndexOf("/")+1)}},{key:"deleteData",value:function(t){}},{key:"navigationEdit",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];$("#back").attr("href","#list/"+t.substr(0,t.lastIndexOf("/")+1)),$("#attrTab").click(),i?$("#saveButton").attr("href","#saveNewFile/"):$("#saveButton").attr("href","#save/"+t);var e,a;i?(e=-1,this.tempData=a={file:{path:"yeniDosya.md"},content:{}}):(e=this.findAll([{attr:"file.path",value:t,op:"=="}])[0],a=this.data[e]);var n=t.split("/");n.pop(),n=n.join("/")+"/";var s=this.getType("/"+n);void 0===s["file.path"]&&(s["file.path"]=this.defaultType("file.path",""));var l=[[],[],[],[]];l[2].push("file.path");for(var o in a.content)void 0===s[o]?l[0].push(o):void 0!==s[o].edit.section?l[s[o].edit.section].push(o):l[1].push(o);for(o in s)void 0===a.content[o]&&void 0!==s[o].edit&&(2==s[o].edit.type||1==s[o].edit.type&&i)&&(void 0!==s[o].edit.section?l[s[o].edit.section].push(o):l[1].push(o));var r="";for(o in l[1])r+=this.templateInput(s[l[1][o]],this.getDataAttr(l[1][o],e),"edit");this.write('<h4 class="ui dividing header">Genel Bilgiler</h4>'+r,"#edit1",!0),r="";for(o in l[2])r+=this.templateInput(s[l[2][o]],this.getDataAttr(l[2][o],e),"edit");this.write('<h4 class="ui dividing header">Yayınlama Bilgileri</h4>'+r,"#edit2",!0),r="";for(o in l[0])r+=this.templateInput(this.defaultType(l[0][o],this.getDataAttr(l[0][o],e)),this.getDataAttr(l[0][o],e),"edit");this.write(r,"#edit0",!0),r="";for(o in l[3])r+=this.templateInput(s[l[3][o]],this.getDataAttr(l[3][o],e),"edit");this.write(r,"#edit3",!0),this.inputInit({url:t})}},{key:"navigationList",value:function(t){$("#newFile").attr("href","#new/"+t);var i=this.findAll([{attr:"file.path",value:t,op:"path"}]),e=this.getType("/"+t),a=this.getAttrList(i,e),n="";for(var s in i){n+=a.indexOf("title")==-1?'<tr><td class="collapsing"><i class="file outline icon"></i> '+this.data[i[s]].file.path.split("/").pop()+"</td>":'<tr><td class="collapsing" title="'+this.data[i[s]].file.path+'"><i class="file outline icon"></i></td>';for(var l in a)void 0===e[a[l]]&&(e[a[l]]={attr:a[l],title:a[l],list:{show:!0},input:{type:"text"}}),n+=this.templateInput(e[a[l]],this.getDataAttr(a[l],i[s]),"list");var o="green";"_"==this.data[i[s]].file.path.split("/").pop().substr(0,1)&&(o="red"),n+='<td class="right aligned collapsing">\n\t\t\t\t\t\t\t\t<a href="#edit/'+this.data[i[s]].file.path+'"><i class="edit icon"></i></a>\n\t\t\t\t\t\t\t\t<a href="#toggle/'+this.data[i[s]].file.path+'"><i class="circle icon '+o+'"></i></a>\n\t\t\t\t\t\t\t\t<a href="#delete/'+this.data[i[s]].file.path+'"><i class="remove icon red"></i></a>\n\t\t\t\t\t\t\t</td></tr>'}var r="";for(var l in a)r+=void 0===e[a[l]]?"<th>"+a[l]+"</th>":"<th>"+e[a[l]].title+"</th>";this.write("<tr><th></th>"+r+"<th>İşlemler</th></tr>","thead",!0),this.write(n,"tbody",!0);var h=this.getDirs(t);i="";for(s in h)i+='\n<a class="item" href="#list/'+t+h[s]+'/">\n\t<i class="big folder icon"></i>\n\t<div class="content">\n\t\t<div class="header">'+h[s]+"</div>\n\t</div>\n</a>";this.write(i,"#dirs",!0)}},{key:"navigation",value:function(){$(".page").hide();var t=window.location.href.split("#");if(!(t.length<2)){t=t[1];var i=t.split("/");if(!(i.length<2))switch(i[0]){case"list":i.shift(),this.navigationList(i.join("/")),$("#list").show();break;case"edit":i.shift(),this.navigationEdit(i.join("/")),$("#edit").show();break;case"new":i.shift(),this.navigationEdit(i.join("/"),!0),$("#edit").show();break;case"save":i.shift(),this.navigationSave(i.join("/")),$("#loader").show();break;case"saveNewFile":i.shift(),this.navigationSave(i.join("/"),!0),$("#loader").show();break;case"delete":i.shift(),this.navigationDelete(i.join("/"));break;case"toggle":i.shift(),this.navigationToggle(i.join("/"));break;default:"()"==i[0].substr(-2)?this[i[0].substr(0,i[0].length-2)](i.join("/")):console.log(i[0]+" sayfası bulunamadı.")}}}},{key:"navigationSave",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.log("save");var e={};$("#edit :input").each(function(){if(void 0!==$(this).attr("name"))if("datetime"==$(this).attr("type")){var t=new Date($(this).parents(".ui.calendar").calendar("get date"));t.setHours(t.getHours()+3),t=t.toJSON(),e[$(this).attr("name")]=t.substring(0,t.indexOf("T"))+" "+t.substring(t.indexOf("T")+1,t.lastIndexOf(":"))}else e[$(this).attr("name")]=$(this).val()}),this.saveData(t,e,i),window.location.href="#list/"+t.substring(0,t.lastIndexOf("/")+1)}},{key:"saveData",value:function(t,i){arguments.length>2&&void 0!==arguments[2]&&arguments[2]}},{key:"navigationToggle",value:function(t){var i=this.findAll([{attr:"file.path",value:t,op:"=="}])[0],e=this.data[i].file.path.split("/"),a=e.pop();a="_"==a.substr(0,1)?a.substr(1):"_"+a,this.data[i].file.path=e.join("/")+"/"+a,this.renameData(t,this.data[i].file.path),window.location.href="#list/"+t.substring(0,t.lastIndexOf("/")+1)}},{key:"renameData",value:function(t,i){}}]),t}();